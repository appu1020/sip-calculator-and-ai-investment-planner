<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics - AI Investment Planner</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/themes.css">
</head>
<body class="light-theme">
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <h1>ðŸ’° AI Investment Planner</h1>
            </div>
            <div class="nav-links">
                <a href="index.html">Dashboard</a>
                <a href="calculator.html">SIP Calculator</a>
                <a href="planner.html">Portfolio Planner</a>
                <a href="analytics.html" class="active">Analytics</a>
                <button id="theme-toggle" class="theme-btn" aria-label="Toggle theme">ðŸŒ“</button>
            </div>
        </div>
    </nav>

    <main class="container">
        <section class="page-header">
            <h1 class="page-title">Investment Analytics</h1>
            <p class="page-subtitle">Comprehensive analysis of your investments with interactive charts</p>
        </section>

        <!-- Comparison Charts Section -->
        <section class="analytics-section">
            <div class="card">
                <div class="card-header">
                    <h2>SIP Comparison</h2>
                    <button id="add-comparison" class="btn btn-secondary">Add SIP to Compare</button>
                </div>
                <canvas id="comparison-chart"></canvas>
            </div>
        </section>

        <!-- Growth Projection Charts -->
        <section class="analytics-section">
            <div class="charts-grid-2">
                <div class="card chart-card">
                    <h3>Growth Projection</h3>
                    <canvas id="growth-projection-chart"></canvas>
                </div>
                <div class="card chart-card">
                    <h3>Returns Breakdown</h3>
                    <canvas id="returns-breakdown-chart"></canvas>
                </div>
            </div>
        </section>

        <!-- Year-wise Analysis -->
        <section class="analytics-section">
            <div class="card chart-card">
                <h3>Year-wise Growth Analysis</h3>
                <canvas id="yearly-growth-chart"></canvas>
            </div>
        </section>

        <!-- Portfolio Analytics -->
        <section class="analytics-section">
            <div class="charts-grid-2">
                <div class="card chart-card">
                    <h3>Portfolio Allocation</h3>
                    <canvas id="portfolio-analytics-chart"></canvas>
                </div>
                <div class="card chart-card">
                    <h3>Risk-Return Analysis</h3>
                    <canvas id="risk-return-chart"></canvas>
                </div>
            </div>
        </section>

        <!-- Data Tables -->
        <section class="analytics-section">
            <div class="card">
                <div class="card-header">
                    <h2>Investment Summary Table</h2>
                    <button id="export-all" class="btn btn-primary">Export All Data</button>
                </div>
                <div class="table-container">
                    <table id="summary-table">
                        <thead>
                            <tr>
                                <th>Investment Type</th>
                                <th>Amount Invested</th>
                                <th>Current Value</th>
                                <th>Returns</th>
                                <th>ROI %</th>
                                <th>Risk Level</th>
                            </tr>
                        </thead>
                        <tbody id="summary-table-body">
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Detailed Analytics Cards -->
        <section class="analytics-cards">
            <div class="card stat-card">
                <h3>Total Investments</h3>
                <div class="stat-value" id="total-investments">â‚¹0</div>
                <div class="stat-change" id="total-investments-change">+0%</div>
            </div>
            <div class="card stat-card">
                <h3>Current Portfolio Value</h3>
                <div class="stat-value" id="portfolio-value">â‚¹0</div>
                <div class="stat-change" id="portfolio-value-change">+0%</div>
            </div>
            <div class="card stat-card">
                <h3>Total Returns</h3>
                <div class="stat-value" id="total-returns-analytics">â‚¹0</div>
                <div class="stat-change" id="total-returns-change">+0%</div>
            </div>
            <div class="card stat-card">
                <h3>Average ROI</h3>
                <div class="stat-value" id="avg-roi">0%</div>
                <div class="stat-change">Weighted Average</div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 AI Investment Planner. All rights reserved.</p>
        </div>
    </footer>

    <!-- Add SIP Comparison Modal -->
    <div id="add-sip-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add SIP for Comparison</h2>
                <button class="modal-close" onclick="closeAddSIPModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="add-sip-form">
                    <div class="form-group">
                        <label for="sip-name">SIP Name</label>
                        <input type="text" id="sip-name" placeholder="e.g., Aggressive Growth" required>
                    </div>
                    <div class="form-group">
                        <label for="sip-amount">Monthly Amount (â‚¹)</label>
                        <input type="number" id="sip-amount" min="500" step="500" value="5000" required>
                    </div>
                    <div class="form-group">
                        <label for="sip-period">Period (Years)</label>
                        <input type="number" id="sip-period" min="1" max="50" value="10" required>
                    </div>
                    <div class="form-group">
                        <label for="sip-returns">Expected Returns (%)</label>
                        <input type="number" id="sip-returns" min="5" max="20" step="0.5" value="12" required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Add to Comparison</button>
                        <button type="button" class="btn btn-outline" onclick="closeAddSIPModal()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/calculator.js"></script>
    <script src="js/planner.js"></script>
    <script src="js/analytics.js"></script>
    <script src="js/charts.js"></script>
    <script>
        // Theme toggle
        document.getElementById('theme-toggle').addEventListener('click', function() {
            document.body.classList.toggle('light-theme');
            document.body.classList.toggle('dark-theme');
            const isDark = document.body.classList.contains('dark-theme');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });

        // Load saved theme
        const savedTheme = localStorage.getItem('theme') || 'light';
        if (savedTheme === 'dark') {
            document.body.classList.remove('light-theme');
            document.body.classList.add('dark-theme');
        }

        let comparisonSIPs = [];
        let comparisonChart = null;
        let growthProjectionChart = null;
        let returnsBreakdownChart = null;
        let yearlyGrowthChart = null;
        let portfolioAnalyticsChart = null;
        let riskReturnChart = null;

        function closeAddSIPModal() {
            document.getElementById('add-sip-modal').style.display = 'none';
        }

        document.getElementById('add-comparison').addEventListener('click', function() {
            document.getElementById('add-sip-modal').style.display = 'flex';
        });

        document.getElementById('add-sip-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const sip = {
                name: document.getElementById('sip-name').value,
                amount: parseFloat(document.getElementById('sip-amount').value),
                period: parseFloat(document.getElementById('sip-period').value),
                returns: parseFloat(document.getElementById('sip-returns').value)
            };
            comparisonSIPs.push(sip);
            setStorageData('comparisonSIPs', comparisonSIPs);
            updateComparisonChart();
            closeAddSIPModal();
            document.getElementById('add-sip-form').reset();
        });

        function updateComparisonChart() {
            if (comparisonSIPs.length === 0) {
                // Load default data from saved scenarios
                const scenarios = getStorageData('sipScenarios') || [];
                if (scenarios.length > 0) {
                    comparisonSIPs = scenarios.slice(0, 3).map(s => ({
                        name: s.name,
                        amount: s.monthlyAmount,
                        period: s.period,
                        returns: s.expectedReturns
                    }));
                }
            }

            if (comparisonSIPs.length === 0) return;

            const ctx = document.getElementById('comparison-chart').getContext('2d');
            
            if (comparisonChart) {
                comparisonChart.destroy();
            }

            comparisonChart = createComparisonChart(ctx, comparisonSIPs);
        }

        function loadAllAnalytics() {
            // Load portfolios and SIPs
            const portfolios = getStorageData('portfolios') || [];
            const sipScenarios = getStorageData('sipScenarios') || [];

            // Update summary statistics
            updateSummaryStatistics(portfolios, sipScenarios);

            // Update summary table
            updateSummaryTable(portfolios, sipScenarios);

            // Create charts
            createAnalyticsCharts(portfolios, sipScenarios);

            // Update comparison chart
            updateComparisonChart();
        }

        function updateSummaryStatistics(portfolios, sipScenarios) {
            let totalInvested = 0;
            let totalValue = 0;
            let totalReturns = 0;

            portfolios.forEach(p => {
                totalInvested += p.totalInvested || 0;
                totalValue += p.currentValue || 0;
                totalReturns += p.returns || 0;
            });

            sipScenarios.forEach(s => {
                const result = calculateSIP(s.monthlyAmount, s.period, s.expectedReturns);
                totalInvested += result.totalInvested;
                totalValue += result.maturityValue;
                totalReturns += result.returns;
            });

            const avgROI = totalInvested > 0 ? (totalReturns / totalInvested) * 100 : 0;

            document.getElementById('total-investments').textContent = formatCurrency(totalInvested);
            document.getElementById('portfolio-value').textContent = formatCurrency(totalValue);
            document.getElementById('total-returns-analytics').textContent = formatCurrency(totalReturns);
            document.getElementById('total-returns-analytics').className = totalReturns >= 0 ? 'stat-value success' : 'stat-value error';
            document.getElementById('avg-roi').textContent = avgROI.toFixed(2) + '%';
        }

        function updateSummaryTable(portfolios, sipScenarios) {
            const tbody = document.getElementById('summary-table-body');
            tbody.innerHTML = '';

            portfolios.forEach(portfolio => {
                const row = document.createElement('tr');
                const roi = portfolio.totalInvested > 0 ? (portfolio.returns / portfolio.totalInvested) * 100 : 0;
                row.innerHTML = `
                    <td>${portfolio.name}</td>
                    <td>${formatCurrency(portfolio.totalInvested || 0)}</td>
                    <td>${formatCurrency(portfolio.currentValue || 0)}</td>
                    <td class="${portfolio.returns >= 0 ? 'success' : 'error'}">${formatCurrency(portfolio.returns || 0)}</td>
                    <td>${roi.toFixed(2)}%</td>
                    <td>${portfolio.riskLevel || 'Moderate'}</td>
                `;
                tbody.appendChild(row);
            });

            sipScenarios.forEach(scenario => {
                const result = calculateSIP(scenario.monthlyAmount, scenario.period, scenario.expectedReturns);
                const row = document.createElement('tr');
                const roi = (result.returns / result.totalInvested) * 100;
                row.innerHTML = `
                    <td>SIP: ${scenario.name}</td>
                    <td>${formatCurrency(result.totalInvested)}</td>
                    <td>${formatCurrency(result.maturityValue)}</td>
                    <td class="success">${formatCurrency(result.returns)}</td>
                    <td>${roi.toFixed(2)}%</td>
                    <td>Moderate</td>
                `;
                tbody.appendChild(row);
            });
        }

        function createAnalyticsCharts(portfolios, sipScenarios) {
            // Growth Projection Chart
            if (sipScenarios.length > 0) {
                const firstSIP = sipScenarios[0];
                const result = calculateSIP(firstSIP.monthlyAmount, firstSIP.period, firstSIP.expectedReturns);
                const ctx = document.getElementById('growth-projection-chart').getContext('2d');
                if (growthProjectionChart) growthProjectionChart.destroy();
                growthProjectionChart = createGrowthChart(result);
            }

            // Returns Breakdown Chart
            if (sipScenarios.length > 0) {
                const firstSIP = sipScenarios[0];
                const result = calculateSIP(firstSIP.monthlyAmount, firstSIP.period, firstSIP.expectedReturns);
                const ctx = document.getElementById('returns-breakdown-chart').getContext('2d');
                if (returnsBreakdownChart) returnsBreakdownChart.destroy();
                returnsBreakdownChart = createReturnsChart(result);
            }

            // Yearly Growth Chart
            if (sipScenarios.length > 0) {
                const firstSIP = sipScenarios[0];
                const result = calculateSIP(firstSIP.monthlyAmount, firstSIP.period, firstSIP.expectedReturns);
                const ctx = document.getElementById('yearly-growth-chart').getContext('2d');
                if (yearlyGrowthChart) yearlyGrowthChart.destroy();
                yearlyGrowthChart = createYearlyGrowthChart(result);
            }

            // Portfolio Allocation Chart
            if (portfolios.length > 0) {
                const portfolio = portfolios[0];
                const ctx = document.getElementById('portfolio-analytics-chart').getContext('2d');
                const labels = ['SIP', 'Stocks', 'Bonds', 'Real Estate', 'Gold'];
                const values = [
                    portfolio.assets.sip.allocation,
                    portfolio.assets.stocks.allocation,
                    portfolio.assets.bonds.allocation,
                    portfolio.assets.realestate.allocation,
                    portfolio.assets.gold.allocation
                ];
                if (portfolioAnalyticsChart) portfolioAnalyticsChart.destroy();
                portfolioAnalyticsChart = createPortfolioAllocationChart(ctx, labels, values);
            }

            // Risk-Return Chart
            const riskReturnData = generateRiskReturnData(portfolios, sipScenarios);
            const ctx = document.getElementById('risk-return-chart').getContext('2d');
            if (riskReturnChart) riskReturnChart.destroy();
            riskReturnChart = createRiskReturnChart(ctx, riskReturnData);
        }

        function generateRiskReturnData(portfolios, sipScenarios) {
            const data = [];
            
            portfolios.forEach(p => {
                const risk = calculatePortfolioRisk(p);
                const returns = p.totalInvested > 0 ? (p.returns / p.totalInvested) * 100 : 0;
                data.push({ x: risk, y: returns, label: p.name });
            });

            sipScenarios.forEach(s => {
                const result = calculateSIP(s.monthlyAmount, s.period, s.expectedReturns);
                const returns = (result.returns / result.totalInvested) * 100;
                data.push({ x: 5, y: returns, label: s.name });
            });

            return data;
        }

        function calculatePortfolioRisk(portfolio) {
            // Simple risk calculation based on asset allocation
            const riskScores = {
                sip: 5,
                stocks: 8,
                bonds: 3,
                realestate: 4,
                gold: 4
            };

            let weightedRisk = 0;
            weightedRisk += (portfolio.assets.sip.allocation / 100) * riskScores.sip;
            weightedRisk += (portfolio.assets.stocks.allocation / 100) * riskScores.stocks;
            weightedRisk += (portfolio.assets.bonds.allocation / 100) * riskScores.bonds;
            weightedRisk += (portfolio.assets.realestate.allocation / 100) * riskScores.realestate;
            weightedRisk += (portfolio.assets.gold.allocation / 100) * riskScores.gold;

            return weightedRisk;
        }

        // Export functionality
        document.getElementById('export-all').addEventListener('click', function() {
            exportAnalyticsData();
        });

        function exportAnalyticsData() {
            const portfolios = getStorageData('portfolios') || [];
            const sipScenarios = getStorageData('sipScenarios') || [];
            
            let csv = 'Investment Type,Amount Invested,Current Value,Returns,ROI %,Risk Level\n';
            
            portfolios.forEach(p => {
                const roi = p.totalInvested > 0 ? (p.returns / p.totalInvested) * 100 : 0;
                csv += `${p.name},${p.totalInvested || 0},${p.currentValue || 0},${p.returns || 0},${roi.toFixed(2)}%,${p.riskLevel || 'Moderate'}\n`;
            });

            sipScenarios.forEach(s => {
                const result = calculateSIP(s.monthlyAmount, s.period, s.expectedReturns);
                const roi = (result.returns / result.totalInvested) * 100;
                csv += `SIP: ${s.name},${result.totalInvested},${result.maturityValue},${result.returns},${roi.toFixed(2)}%,Moderate\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `investment-analytics-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }

        // Load saved comparison SIPs
        comparisonSIPs = getStorageData('comparisonSIPs') || [];

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadAllAnalytics();
        });
    </script>
</body>
</html>




