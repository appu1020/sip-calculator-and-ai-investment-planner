<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Planner - AI Investment Planner</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/themes.css">
</head>
<body class="light-theme">
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <h1>ðŸ’° AI Investment Planner</h1>
            </div>
            <div class="nav-links">
                <a href="index.html">Dashboard</a>
                <a href="calculator.html">SIP Calculator</a>
                <a href="planner.html" class="active">Portfolio Planner</a>
                <a href="analytics.html">Analytics</a>
                <button id="theme-toggle" class="theme-btn" aria-label="Toggle theme">ðŸŒ“</button>
            </div>
        </div>
    </nav>

    <main class="container">
        <!-- Risk Assessment Modal -->
        <div id="risk-assessment-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Risk Assessment Questionnaire</h2>
                    <button class="modal-close" onclick="closeRiskAssessment()">Ã—</button>
                </div>
                <div class="modal-body">
                    <form id="risk-assessment-form">
                        <div class="question-group">
                            <label>1. What is your investment time horizon?</label>
                            <select id="q1" required>
                                <option value="">Select...</option>
                                <option value="short">Less than 5 years</option>
                                <option value="medium">5-10 years</option>
                                <option value="long">10-20 years</option>
                                <option value="very-long">More than 20 years</option>
                            </select>
                        </div>
                        <div class="question-group">
                            <label>2. How would you react to a 20% market drop?</label>
                            <select id="q2" required>
                                <option value="">Select...</option>
                                <option value="panic">Sell immediately</option>
                                <option value="concern">Move to safer options</option>
                                <option value="hold">Hold and wait</option>
                                <option value="buy">Buy more</option>
                            </select>
                        </div>
                        <div class="question-group">
                            <label>3. What is your primary investment goal?</label>
                            <select id="q3" required>
                                <option value="">Select...</option>
                                <option value="capital-preservation">Capital Preservation</option>
                                <option value="balanced-growth">Balanced Growth</option>
                                <option value="aggressive-growth">Aggressive Growth</option>
                                <option value="max-returns">Maximum Returns</option>
                            </select>
                        </div>
                        <div class="question-group">
                            <label>4. What percentage of loss can you tolerate?</label>
                            <select id="q4" required>
                                <option value="">Select...</option>
                                <option value="low">0-5%</option>
                                <option value="moderate">5-10%</option>
                                <option value="high">10-20%</option>
                                <option value="very-high">20%+</option>
                            </select>
                        </div>
                        <div class="question-group">
                            <label>5. How familiar are you with investments?</label>
                            <select id="q5" required>
                                <option value="">Select...</option>
                                <option value="beginner">Beginner</option>
                                <option value="intermediate">Intermediate</option>
                                <option value="advanced">Advanced</option>
                                <option value="expert">Expert</option>
                            </select>
                        </div>
                        <div class="question-group">
                            <label>6. What is your investment experience?</label>
                            <select id="q6" required>
                                <option value="">Select...</option>
                                <option value="none">None</option>
                                <option value="limited">Limited (1-3 years)</option>
                                <option value="moderate">Moderate (3-10 years)</option>
                                <option value="extensive">Extensive (10+ years)</option>
                            </select>
                        </div>
                        <div class="question-group">
                            <label>7. What is your income stability?</label>
                            <select id="q7" required>
                                <option value="">Select...</option>
                                <option value="unstable">Unstable/Variable</option>
                                <option value="stable">Stable</option>
                                <option value="very-stable">Very Stable</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Submit Assessment</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <section class="page-header">
            <h1 class="page-title">Portfolio Planner</h1>
            <p class="page-subtitle">Build and manage your investment portfolio with AI recommendations</p>
        </section>

        <!-- Portfolio Builder -->
        <div class="portfolio-builder">
            <div class="card">
                <div class="card-header">
                    <h2>Create New Portfolio</h2>
                    <button id="get-ai-recommendations" class="btn btn-secondary">Get AI Recommendations</button>
                </div>
                
                <form id="portfolio-form">
                    <div class="form-group">
                        <label for="portfolio-name">Portfolio Name</label>
                        <input type="text" id="portfolio-name" placeholder="e.g., Retirement Fund 2030" required>
                    </div>

                    <div class="form-group">
                        <label for="investment-goal">Investment Goal</label>
                        <select id="investment-goal" required>
                            <option value="">Select a goal...</option>
                            <option value="retirement">Retirement Planning</option>
                            <option value="education">Education Fund</option>
                            <option value="house">House Purchase</option>
                            <option value="vacation">Vacation/Travel</option>
                            <option value="emergency">Emergency Fund</option>
                            <option value="wealth-building">Wealth Building</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="target-amount">Target Amount (â‚¹)</label>
                        <input type="number" id="target-amount" min="10000" step="10000" placeholder="1000000">
                    </div>

                    <div class="form-group">
                        <label for="time-horizon">Time Horizon (Years)</label>
                        <input type="number" id="time-horizon" min="1" max="50" step="1" required>
                    </div>

                    <h3>Asset Allocation</h3>
                    <div id="asset-allocation" class="asset-allocation">
                        <div class="asset-item">
                            <label>
                                <span>SIP/Mutual Funds (%)</span>
                                <input type="number" id="asset-sip" min="0" max="100" step="5" value="40">
                            </label>
                            <div class="asset-inputs" id="sip-inputs">
                                <input type="number" placeholder="Monthly amount (â‚¹)" min="500" step="500">
                                <input type="number" placeholder="Expected returns (%)" min="8" max="18" step="0.5" value="12">
                            </div>
                        </div>
                        <div class="asset-item">
                            <label>
                                <span>Stocks/Equities (%)</span>
                                <input type="number" id="asset-stocks" min="0" max="100" step="5" value="30">
                            </label>
                            <div class="asset-inputs" id="stocks-inputs">
                                <input type="number" placeholder="Lump sum or monthly (â‚¹)" min="1000" step="1000">
                                <input type="number" placeholder="Expected returns (%)" min="10" max="20" step="0.5" value="15">
                            </div>
                        </div>
                        <div class="asset-item">
                            <label>
                                <span>Bonds/Fixed Income (%)</span>
                                <input type="number" id="asset-bonds" min="0" max="100" step="5" value="20">
                            </label>
                            <div class="asset-inputs" id="bonds-inputs">
                                <input type="number" placeholder="Amount (â‚¹)" min="1000" step="1000">
                                <input type="number" placeholder="Expected returns (%)" min="5" max="10" step="0.5" value="7">
                            </div>
                        </div>
                        <div class="asset-item">
                            <label>
                                <span>Real Estate (%)</span>
                                <input type="number" id="asset-realestate" min="0" max="100" step="5" value="5">
                            </label>
                            <div class="asset-inputs" id="realestate-inputs">
                                <input type="number" placeholder="Amount (â‚¹)" min="50000" step="10000">
                                <input type="number" placeholder="Expected returns (%)" min="6" max="12" step="0.5" value="8">
                            </div>
                        </div>
                        <div class="asset-item">
                            <label>
                                <span>Gold/Commodities (%)</span>
                                <input type="number" id="asset-gold" min="0" max="100" step="5" value="5">
                            </label>
                            <div class="asset-inputs" id="gold-inputs">
                                <input type="number" placeholder="Amount (â‚¹)" min="1000" step="1000">
                                <input type="number" placeholder="Expected returns (%)" min="5" max="10" step="0.5" value="7">
                            </div>
                        </div>
                    </div>
                    <div class="allocation-summary">
                        <span>Total Allocation: <strong id="allocation-total">100%</strong></span>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Create Portfolio</button>
                        <button type="button" id="reset-portfolio" class="btn btn-outline">Reset</button>
                    </div>
                </form>
            </div>

            <!-- AI Recommendations Panel -->
            <div class="card" id="ai-recommendations-panel" style="display: none;">
                <h2>AI Recommendations</h2>
                <div id="ai-recommendations-content"></div>
            </div>
        </div>

        <!-- Portfolio Allocation Chart -->
        <div class="card chart-card" id="portfolio-chart-card" style="display: none;">
            <h2>Portfolio Allocation</h2>
            <canvas id="portfolio-allocation-chart"></canvas>
        </div>

        <!-- Saved Portfolios -->
        <section class="saved-portfolios">
            <div class="card">
                <h2>Your Portfolios</h2>
                <div id="portfolios-list" class="portfolios-grid">
                    <!-- Portfolios will be loaded here -->
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 AI Investment Planner. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/planner.js"></script>
    <script src="js/ai-engine.js"></script>
    <script src="js/charts.js"></script>
    <script>
        // Theme toggle
        document.getElementById('theme-toggle').addEventListener('click', function() {
            document.body.classList.toggle('light-theme');
            document.body.classList.toggle('dark-theme');
            const isDark = document.body.classList.contains('dark-theme');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });

        // Load saved theme
        const savedTheme = localStorage.getItem('theme') || 'light';
        if (savedTheme === 'dark') {
            document.body.classList.remove('light-theme');
            document.body.classList.add('dark-theme');
        }

        // Check if assessment should be shown
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('assessment') === 'true') {
            document.getElementById('risk-assessment-modal').style.display = 'flex';
        }

        function closeRiskAssessment() {
            document.getElementById('risk-assessment-modal').style.display = 'none';
        }

        // Risk assessment form
        document.getElementById('risk-assessment-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const answers = {
                timeHorizon: document.getElementById('q1').value,
                riskTolerance: document.getElementById('q2').value,
                investmentGoal: document.getElementById('q3').value,
                lossTolerance: document.getElementById('q4').value,
                knowledgeLevel: document.getElementById('q5').value,
                experience: document.getElementById('q6').value,
                incomeStability: document.getElementById('q7').value
            };

            const riskProfile = assessRiskProfile(answers);
            setStorageData('riskProfile', riskProfile);
            closeRiskAssessment();
            updateAIRecommendations();
        });

        // Allocation total calculation
        const allocationInputs = ['asset-sip', 'asset-stocks', 'asset-bonds', 'asset-realestate', 'asset-gold'];
        allocationInputs.forEach(id => {
            document.getElementById(id).addEventListener('input', updateAllocationTotal);
        });

        function updateAllocationTotal() {
            const total = allocationInputs.reduce((sum, id) => {
                return sum + (parseFloat(document.getElementById(id).value) || 0);
            }, 0);
            document.getElementById('allocation-total').textContent = total + '%';
            if (total !== 100) {
                document.getElementById('allocation-total').parentElement.classList.add('warning');
            } else {
                document.getElementById('allocation-total').parentElement.classList.remove('warning');
            }
        }

        // Portfolio form submission
        document.getElementById('portfolio-form').addEventListener('submit', function(e) {
            e.preventDefault();
            createPortfolio();
        });

        // Get AI recommendations
        document.getElementById('get-ai-recommendations').addEventListener('click', function() {
            updateAIRecommendations();
            document.getElementById('ai-recommendations-panel').style.display = 'block';
        });

        function createPortfolio() {
            const portfolio = {
                id: generateId(),
                name: document.getElementById('portfolio-name').value,
                goal: document.getElementById('investment-goal').value,
                targetAmount: parseFloat(document.getElementById('target-amount').value) || 0,
                timeHorizon: parseFloat(document.getElementById('time-horizon').value),
                assets: {
                    sip: {
                        allocation: parseFloat(document.getElementById('asset-sip').value),
                        amount: parseFloat(document.getElementById('sip-inputs').querySelector('input').value) || 0,
                        returns: parseFloat(document.getElementById('sip-inputs').querySelectorAll('input')[1].value)
                    },
                    stocks: {
                        allocation: parseFloat(document.getElementById('asset-stocks').value),
                        amount: parseFloat(document.getElementById('stocks-inputs').querySelector('input').value) || 0,
                        returns: parseFloat(document.getElementById('stocks-inputs').querySelectorAll('input')[1].value)
                    },
                    bonds: {
                        allocation: parseFloat(document.getElementById('asset-bonds').value),
                        amount: parseFloat(document.getElementById('bonds-inputs').querySelector('input').value) || 0,
                        returns: parseFloat(document.getElementById('bonds-inputs').querySelectorAll('input')[1].value)
                    },
                    realestate: {
                        allocation: parseFloat(document.getElementById('asset-realestate').value),
                        amount: parseFloat(document.getElementById('realestate-inputs').querySelector('input').value) || 0,
                        returns: parseFloat(document.getElementById('realestate-inputs').querySelectorAll('input')[1].value)
                    },
                    gold: {
                        allocation: parseFloat(document.getElementById('asset-gold').value),
                        amount: parseFloat(document.getElementById('gold-inputs').querySelector('input').value) || 0,
                        returns: parseFloat(document.getElementById('gold-inputs').querySelectorAll('input')[1].value)
                    }
                },
                timestamp: Date.now()
            };

            // Calculate portfolio value
            portfolio.totalInvested = calculatePortfolioValue(portfolio);
            portfolio.currentValue = calculatePortfolioReturns(portfolio);
            portfolio.returns = portfolio.currentValue - portfolio.totalInvested;

            savePortfolio(portfolio);
            loadPortfolios();
            displayPortfolioChart(portfolio);
            
            // Reset form
            document.getElementById('portfolio-form').reset();
            updateAllocationTotal();
        }

        function loadPortfolios() {
            const portfolios = getStorageData('portfolios') || [];
            const container = document.getElementById('portfolios-list');
            
            if (portfolios.length === 0) {
                container.innerHTML = '<p class="empty-state">No portfolios created yet. Create your first portfolio above.</p>';
                return;
            }

            container.innerHTML = portfolios.map(portfolio => `
                <div class="portfolio-card">
                    <div class="portfolio-card-header">
                        <h3>${portfolio.name}</h3>
                        <button onclick="deletePortfolio('${portfolio.id}')" class="btn-icon">Ã—</button>
                    </div>
                    <div class="portfolio-card-body">
                        <div class="portfolio-info">
                            <div class="info-row">
                                <span>Goal:</span>
                                <span>${portfolio.goal}</span>
                            </div>
                            <div class="info-row">
                                <span>Time Horizon:</span>
                                <span>${portfolio.timeHorizon} years</span>
                            </div>
                            <div class="info-row highlight">
                                <span>Current Value:</span>
                                <span>${formatCurrency(portfolio.currentValue || 0)}</span>
                            </div>
                            <div class="info-row">
                                <span>Returns:</span>
                                <span class="${portfolio.returns >= 0 ? 'success' : 'error'}">${formatCurrency(portfolio.returns || 0)}</span>
                            </div>
                        </div>
                        <div class="portfolio-actions">
                            <button onclick="viewPortfolio('${portfolio.id}')" class="btn btn-primary btn-small">View Details</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function deletePortfolio(id) {
            if (confirm('Are you sure you want to delete this portfolio?')) {
                let portfolios = getStorageData('portfolios') || [];
                portfolios = portfolios.filter(p => p.id !== id);
                setStorageData('portfolios', portfolios);
                loadPortfolios();
            }
        }

        function viewPortfolio(id) {
            const portfolios = getStorageData('portfolios') || [];
            const portfolio = portfolios.find(p => p.id === id);
            if (portfolio) {
                displayPortfolioChart(portfolio);
                document.getElementById('portfolio-chart-card').scrollIntoView({ behavior: 'smooth' });
            }
        }

        function displayPortfolioChart(portfolio) {
            const ctx = document.getElementById('portfolio-allocation-chart').getContext('2d');
            
            if (window.portfolioChart) {
                window.portfolioChart.destroy();
            }

            const labels = ['SIP/Mutual Funds', 'Stocks', 'Bonds', 'Real Estate', 'Gold'];
            const values = [
                portfolio.assets.sip.allocation,
                portfolio.assets.stocks.allocation,
                portfolio.assets.bonds.allocation,
                portfolio.assets.realestate.allocation,
                portfolio.assets.gold.allocation
            ];

            window.portfolioChart = createPortfolioAllocationChart(ctx, labels, values);
            document.getElementById('portfolio-chart-card').style.display = 'block';
        }

        function updateAIRecommendations() {
            const riskProfile = getStorageData('riskProfile');
            if (!riskProfile) {
                document.getElementById('ai-recommendations-panel').style.display = 'block';
                document.getElementById('ai-recommendations-content').innerHTML = 
                    '<p>Please complete the risk assessment first.</p><button onclick="document.getElementById(\'risk-assessment-modal\').style.display=\'flex\'" class="btn btn-primary">Take Assessment</button>';
                return;
            }

            const goal = document.getElementById('investment-goal').value;
            const timeHorizon = parseFloat(document.getElementById('time-horizon').value) || 10;
            const targetAmount = parseFloat(document.getElementById('target-amount').value) || 0;

            const recommendations = getAIRecommendations(riskProfile, { goal, timeHorizon, targetAmount });
            
            document.getElementById('ai-recommendations-content').innerHTML = `
                <div class="risk-badge ${riskProfile.riskLevel.toLowerCase()}">${riskProfile.riskLevel} Risk Profile</div>
                <p class="insight-text">${recommendations.summary}</p>
                <h4>Recommended Allocation:</h4>
                <ul class="recommendations-list">
                    ${recommendations.allocation.map(rec => `<li>${rec}</li>`).join('')}
                </ul>
                <h4>Action Items:</h4>
                <ul class="recommendations-list">
                    ${recommendations.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                </ul>
                <button onclick="applyRecommendations()" class="btn btn-primary">Apply Recommendations</button>
            `;
        }

        function applyRecommendations() {
            const riskProfile = getStorageData('riskProfile');
            if (!riskProfile) return;

            const allocations = getRecommendedAllocation(riskProfile);
            document.getElementById('asset-sip').value = allocations.sip;
            document.getElementById('asset-stocks').value = allocations.stocks;
            document.getElementById('asset-bonds').value = allocations.bonds;
            document.getElementById('asset-realestate').value = allocations.realestate;
            document.getElementById('asset-gold').value = allocations.gold;
            updateAllocationTotal();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadPortfolios();
            updateAllocationTotal();
            
            // Check if risk profile exists
            const riskProfile = getStorageData('riskProfile');
            if (!riskProfile) {
                document.getElementById('risk-assessment-modal').style.display = 'flex';
            }
        });
    </script>
</body>
</html>




